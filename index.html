// Burger menu (mobile)
const burger = document.querySelector('.burger');
const menu = document.querySelector('.menu');
if (burger && menu) {
  burger.addEventListener('click', () => {
    const open = menu.classList.toggle('open');
    burger.setAttribute('aria-expanded', String(open));
  });
}

// ==============================
// üéµ Musique de fond (playlist + reprise entre pages)
// ==============================
const tracks = [
  "assets/music/piano-chill.wav",
  "assets/music/lofi-soft.wav",
  "assets/music/ambient-light.wav"
];

let currentTrack = 0;
let music; // sera d√©fini apr√®s DOMContentLoaded

window.addEventListener('DOMContentLoaded', () => {
  music = document.getElementById('bg-music');
  if (!music) return;

  // Charger une piste
  function loadAndPlay(i) {
    currentTrack = i % tracks.length;
    music.src = tracks[currentTrack];
    music.load();
    music.play().catch(() => {});
  }

  // ---------- Reprise depuis localStorage ----------
  const savedTrack = localStorage.getItem("musicTrack");
  const savedTime = localStorage.getItem("musicTime");
  const savedMuted = localStorage.getItem("musicMuted");

  if (savedTrack !== null) {
    loadAndPlay(parseInt(savedTrack));
  } else {
    loadAndPlay(0);
  }

  music.addEventListener("loadeddata", () => {
    if (savedTime !== null) {
      music.currentTime = parseFloat(savedTime);
    }
    if (savedMuted === "false") {
      music.muted = false;
      music.play().catch(()=>{});
    }
  });

  // ---------- Encha√Ænement automatique ----------
  music.addEventListener("ended", () => loadAndPlay(currentTrack + 1));

  // ---------- Sauvegarde avant de quitter ----------
  window.addEventListener("beforeunload", () => {
    localStorage.setItem("musicTrack", currentTrack);
    localStorage.setItem("musicTime", music.currentTime);
    localStorage.setItem("musicMuted", music.muted);
  });

  // ---------- Bouton toggle ----------
  window.toggleMusic = function () {
    if (music.muted) {
      music.muted = false;
      music.play().catch(()=>{});
    } else {
      music.muted = true;
      music.pause();
    }
    localStorage.setItem("musicMuted", music.muted);
  };

  // ---------- Volume ----------
  window.setVolume = function (v) {
    const vol = Math.max(0, Math.min(1, parseFloat(v)));
    music.volume = vol;
    localStorage.setItem('musicVolume', String(vol));
  };

  // Restaurer volume sauvegard√©
  const savedVol = localStorage.getItem('musicVolume');
  if (savedVol !== null) {
    music.volume = parseFloat(savedVol);
    const volInput = document.getElementById('music-volume');
    if (volInput) volInput.value = String(music.volume);
  }
});
